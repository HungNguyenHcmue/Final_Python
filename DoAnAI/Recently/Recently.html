<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Gần Nhất</title>
    <link rel="stylesheet" href="../layout.css">
    <link rel="stylesheet" href="Recently.css">
</head>
<body>
    <!-- Layout container -->
    <div id="layout-container"></div>

    <main>
        <header>
            <h1>Video Được Xem Gần Nhất</h1>
        </header>
        <div id="recent-videos" class="recent-videos-container">
            <!-- Các video gần nhất sẽ được thêm vào đây -->
        </div>
    </main>    
</body>
</html>
<script>
   // Tải layout
 fetch("../layout.php")
 .then(response => response.text())
 .then(data => {
     document.getElementById("layout-container").innerHTML = data;
     initializeLayout();
 })
 .catch(error => console.error("Lỗi tải layout:", error));

function initializeLayout() {
 // Thêm sự kiện click để hiển thị/tắt danh sách lớp
 const menuToggle = document.querySelector(".menu-item");
 const classList = document.getElementById("class-list");

 if (menuToggle && classList) {
    menuToggle.addEventListener("click", () => {
        // Toggle hiển thị danh sách lớp
        classList.style.display = classList.style.display === "block" ? "none" : "block";
    });
}
const logoutButton = document.querySelector(".logout-btn");
if (logoutButton) {
logoutButton.addEventListener("click", () => {
fetch("../Login/logout.php", { method: "POST" })
    .then(response => {
        if (!response.ok) throw new Error("Lỗi khi đăng xuất.");
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Xóa session và chuyển về trang đăng nhập
            window.location.href = "../Login/log-in.html";
        } else {
            alert(data.message || "Đăng xuất thất bại.");
        }
    })
    .catch(error => alert("Có lỗi xảy ra: " + error.message));
});
}
}
// Hiển thị danh sách video gần đây
document.addEventListener("DOMContentLoaded", function () {
    const recentVideos = JSON.parse(localStorage.getItem('recentVideos')) || [];
    const recentVideosContainer = document.getElementById('recent-videos');

    if (recentVideos.length === 0) {
        recentVideosContainer.innerHTML = "<p>Chưa có video nào được xem gần đây.</p>";
        return;
    }

    recentVideos.forEach(videoId => {
        fetch(`Recently.php?id=${videoId}`)
            .then(response => response.json())
            .then(data => {
                if (data && data.video_path) {
                    const videoElement = document.createElement('div');
                    videoElement.className = 'recent-video-item';
                    videoElement.innerHTML = `
                        <div class="video-content">
                            <video src="../Class/${data.video_path}" controls></video>
                            <p class="video-class">${data.class_name}</p>
                            <p class="video-time">Thời gian: ${data.added_at}</p>
                        </div>
                        <button class="delete-btn" data-id="${videoId}">Xóa</button>
                    `;
                    recentVideosContainer.appendChild(videoElement);

                    videoElement.querySelector('.delete-btn').addEventListener('click', function () {
                        const videoIdToDelete = this.getAttribute('data-id');
                        const updatedVideos = recentVideos.filter(id => id !== parseInt(videoIdToDelete));
                        localStorage.setItem('recentVideos', JSON.stringify(updatedVideos));
                        recentVideosContainer.removeChild(videoElement);
                    });
                } else {
                    console.error(`Không tìm thấy video với ID: ${videoId}`);
                }
            })
            .catch(error => console.error("Lỗi tải thông tin video:", error));
    });
});
</script>
